<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
	<title></title>
	<style type="text/css">
	* {
    box-sizing: border-box;
  }

	html, body {
		background-color: #333;
		height: 90%;
	}
		.hide-this{
			display:none;
		}
		#chat_container{
			height:90%;
			background-color: #333;
		}
		#chat_window{
			border: 5px solid #000;
			background-color: grey;
	    	height: 100%;
			width: 90%;
	    	text-align: center;
		}
		#to_id{
			width: 50%;
			margin-left: 25%;
		}
		#msg{
			width: 46.5%;
			margin-left: 25%;
		}
		.self_msg{
			text-align: right;

			color: red;
			font-size: 150%;
			text-shadow:
     3px 3px 5px #000,
     -1px -1px 5px #000,
     1px -1px 5px #000,
     -1px 1px 5px #000,
      1px 1px 5px #000;

		}
		.msg_receive{
			text-align: left;
			color: green;
			font-size: 150%;
			text-shadow:
     3px 3px 5px #000,
     -1px -1px 5px #000,
     1px -1px 5px #000,
     -1px 1px 5px #000,
      1px 1px 5px #000;
		}
		form{
			list-style: none;
	    	word-wrap: break-word;
		}

	</style>
</head>
<body>
	<!-- Utilizzato per settare il nickname dell utente autenticato. (non visibile all utente)-->
	<div id="input_username_container">
		<input type="text" id="id" value="<%= username %>" hidden/>
		<button id="save_id" hidden>Register</button>
	</div>

	<!--Chat privata dove occorre specificare il destinatario del messggio da digitare -->
	<form id="chat_container" class="hide-this" style="margin-top:0;">
		<h3 id="current_user"></h3>
		<div id="chat_window" style="margin: 0; overflow-y: scroll; margin-left: 5%;padding: 10px 20px 10px 20px;"></div>
		<div>
			<h4 style="color:white;" class="text-center">Inserisci il nickname della persona con cui vuoi parlare</h4>
			<div class="input-group" style="width:100%;">
				<input type="text" id="to_id" class="form-control"  value="" />
		</div>
		<div>
			<h4 class="text-center" style="color:white;" >Inserisci il messaggio</h4>
			<div class="input-group" style="width:100%;">
				<input type="text" id="msg" class="form-control" placeholder="Scrivi messaggio qui"/>
				<input type="submit" class="btn btn-primary" id="send_msg" value="Send">
			</div>

		</div>
	</form>

	<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
	<script type="text/javascript" src="/socket.io/socket.io.js"></script>
	<script type="text/javascript">

		var socket = io.connect();

	// Nascondo l'input 'Text-id' e mostro la chat
    $('#save_id').hide();
    $('#input_username_container').hide();
    $('#chat_container').show();
		$('#current_user').val( $('#id').val() );


	// Invio messaggio privato
	$('#chat_container').submit(function(e){
		e.preventDefault()
		var data = {
			to: $('#to_id').val(),
			msg: $('#msg').val()
		}

		socket.emit('private_message_sent', data, function(resp){
			if( !resp )
				alert('Nickname non valido');

			// Invio della risposta, creando un html
			else
			$('#chat_window').append('<div class="self_msg"><b>'+resp.from+' : </b>'+ resp.msg +'</div>')
		})
	})


	// Ascolto cosa ha da dire il server
	socket.on('private_message_from_server',function(data){
		$('#chat_window').append('<div class="msg_receive"><b>'+data.from+' : </b>'+ data.msg +'</div>')
	})



	</script>
</body>
</html>
